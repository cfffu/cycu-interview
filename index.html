<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --primary: #003a6c; --accent: #00a896; --bg: #f0f4f8; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #333; }
        .container { max-width: 800px; margin: 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 25px; font-size: 1.5rem; }
        
        /* ä¿®æ­£è·‘ç‰ˆï¼šæ”¹ç”¨ flex-wrap ä¸¦é™åˆ¶å¯¬åº¦ */
        .filter-grid { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 25px; }
        .select-group { flex: 1 1 calc(50% - 15px); min-width: 280px; display: flex; flex-direction: column; }
        label { margin-bottom: 6px; font-weight: bold; color: #555; font-size: 0.9em; }
        
        select { 
            padding: 12px; border-radius: 10px; border: 2px solid #ddd; 
            font-size: 15px; background: white; cursor: pointer; transition: 0.3s;
            width: 100%; box-sizing: border-box; text-overflow: ellipsis;
        }
        select:focus { border-color: var(--primary); outline: none; }

        /* çµæœå€å¡Šæ¨£å¼ */
        .result-card { display: none; margin-top: 20px; padding: 20px; border-radius: 12px; background: #fff; border-top: 5px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; background: #f8fafc; padding: 15px; border-radius: 10px; }
        .info-item { font-size: 0.95em; color: #444; }
        .info-label { font-weight: bold; color: var(--primary); margin-right: 5px; }
        
        .item-box { margin-bottom: 15px; }
        .item-title { font-weight: bold; color: var(--primary); margin-bottom: 8px; display: flex; align-items: center; }
        .item-title::before { content: "â—†"; margin-right: 8px; color: var(--accent); }
        .item-content { white-space: pre-wrap; background: #f9f9f9; padding: 15px; border-radius: 8px; line-height: 1.6; border: 1px solid #eee; font-size: 0.95em; }
        
        @media (max-width: 600px) { .select-group { flex: 1 1 100%; } .info-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢</h1>
    
    <div class="filter-grid">
        <div class="select-group"><label>1. é¸æ“‡å­¸é™¢</label><select id="sel-college" disabled><option>è¼‰å…¥ä¸­...</option></select></div>
        <div class="select-group"><label>2. é¸æ“‡ç³»æ‰€</label><select id="sel-dept" disabled><option>è«‹å…ˆé¸æ“‡å­¸é™¢</option></select></div>
        <div class="select-group"><label>3. æ‹›ç”Ÿç®¡é“</label><select id="sel-path" disabled><option>è«‹å…ˆé¸æ“‡ç³»æ‰€</option></select></div>
        <div class="select-group"><label>4. å­¸å¹´åº¦</label><select id="sel-year" disabled><option>è«‹å…ˆé¸æ“‡ç®¡é“</option></select></div>
    </div>

    <div id="result" class="result-card">
        <div class="info-grid">
            <div class="info-item"><span class="info-label">é¢è©¦å½¢å¼ï¼š</span><span id="res-type"></span></div>
            <div class="info-item"><span class="info-label">è€ƒç”Ÿäººæ•¸ï¼š</span><span id="res-stus"></span></div>
            <div class="info-item"><span class="info-label">è€ƒå®˜äººæ•¸ï¼š</span><span id="res-profs"></span></div>
            <div class="info-item"><span class="info-label">è€ƒå ´ä½ˆç½®ï¼š</span><span id="res-layout"></span></div>
        </div>

        <div class="item-box">
            <div class="item-title">é¢è©¦æµç¨‹èˆ‡é¡Œç›®</div>
            <div id="res-combined" class="item-content"></div>
        </div>
        <div class="item-box">
            <div class="item-title">çµ¦å­¸å¼Ÿå¦¹çš„å»ºè­°</div>
            <div id="res-advice" class="item-content"></div>
        </div>
    </div>
</div>

<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTikTWQ1NHtmCIoslCCUnqJ_b-UOvFNnF2jkTFRYLthASVeGCZJOZDD5d9gZoy4X3zeQLhb-yHF2CRB/pub?output=csv';

let structure = {};

Papa.parse(csvUrl, {
    download: true, header: true, skipEmptyLines: true,
    complete: function(results) {
        buildStructure(results.data);
        initDropdowns();
    }
});

function buildStructure(data) {
    structure = {};
    data.forEach(row => {
        const colFull = row['é¢è©¦å­¸é™¢']?.trim();
        if (!colFull) return;

        const pureCol = colFull.split('ï¼ˆ')[0].trim();
        let deptKey = Object.keys(row).find(k => k.includes(pureCol) && k !== 'é¢è©¦å­¸é™¢');
        let dept = row[deptKey]?.trim();

        const path = row['é¢è©¦ç®¡é“']?.trim() || "ä¸€èˆ¬æ‹›ç”Ÿ";
        const yr = row['é¢è©¦å­¸å¹´åº¦']?.trim() || "114";

        if (dept) {
            if (!structure[colFull]) structure[colFull] = {};
            if (!structure[colFull][dept]) structure[colFull][dept] = {};
            if (!structure[colFull][dept][path]) structure[colFull][dept][path] = {};
            structure[colFull][dept][path][yr] = row;
        }
    });
}

function initDropdowns() {
    const s1 = document.getElementById('sel-college');
    const s2 = document.getElementById('sel-dept');
    const s3 = document.getElementById('sel-path');
    const s4 = document.getElementById('sel-year');

    const colleges = Object.keys(structure).sort();
    s1.innerHTML = '<option value="">-- é¸æ“‡å­¸é™¢ --</option>';
    colleges.forEach(c => s1.add(new Option(c, c)));
    s1.disabled = false;

    s1.onchange = () => { resetSelect(['sel-dept', 'sel-path', 'sel-year']); updateSelect(s2, structure[s1.value]); };
    s2.onchange = () => { resetSelect(['sel-path', 'sel-year']); updateSelect(s3, structure[s1.value][s2.value]); };
    s3.onchange = () => { resetSelect(['sel-year']); updateSelect(s4, structure[s1.value][s2.value][s3.value]); };
    s4.onchange = showResult;
}

function updateSelect(el, dataSet) {
    el.innerHTML = '<option value="">-- è«‹é¸æ“‡ --</option>';
    if (dataSet) { Object.keys(dataSet).sort().forEach(k => el.add(new Option(k, k))); el.disabled = false; }
}

function resetSelect(ids) {
    ids.forEach(id => { const el = document.getElementById(id); el.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡ä¸Šä¸€é …</option>'; el.disabled = true; });
    document.getElementById('result').style.display = 'none';
}

function showResult() {
    const info = structure[document.getElementById('sel-college').value]
                          [document.getElementById('sel-dept').value]
                          [document.getElementById('sel-path').value]
                          [document.getElementById('sel-year').value];

    // å°æ‡‰è©¦ç®—è¡¨æ¬„ä½åç¨±
    document.getElementById('res-type').innerText = info['å€‹äººã€åœ˜é«”ï¼Ÿ'] || 'ç„¡è³‡æ–™';
    document.getElementById('res-stus').innerText = (info['ä¸€å ´é¢è©¦å¹¾å€‹è€ƒç”Ÿï¼Ÿ'] || '0') + ' äºº';
    document.getElementById('res-profs').innerText = (info['ä¸€å ´é¢è©¦æœ‰å¹¾å€‹æ•™æˆï¼Ÿ'] || '0') + ' ä½';
    document.getElementById('res-layout').innerText = info['è€ƒå ´é•·æ€æ¨£å‘¢ï¼Ÿ'] || 'ç„¡è³‡æ–™';

    // åˆä½µæµç¨‹èˆ‡é¡Œç›®
    const combinedText = `ã€é¢è©¦æµç¨‹èˆ‡é¡Œç›®ã€‘\n${info['é¢è©¦å•é¡ŒåŠæµç¨‹'] || 'ç„¡è³‡æ–™'}`;
    document.getElementById('res-combined').innerText = combinedText;

    // å»ºè­°
    const adviceKey = Object.keys(info).find(k => k.includes('å»ºè­°'));
    document.getElementById('res-advice').innerText = info[adviceKey] || 'ç„¡è³‡æ–™';

    document.getElementById('result').style.display = 'block';
}
</script>
</body>
</html>
