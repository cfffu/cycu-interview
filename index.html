<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { 
            --primary: #003a6c; 
            --accent: #00a896;
            --bg: #f4f7f9;
            --card: #ffffff;
        }
        body { 
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            background: var(--bg); 
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container { 
            max-width: 900px; 
            margin: 40px auto; 
            background: var(--card); 
            padding: 40px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.05); 
        }
        h1 { 
            text-align: center; 
            color: var(--primary); 
            margin-bottom: 30px;
            font-size: 1.8rem;
            letter-spacing: 1px;
        }
        /* ç¶²æ ¼æ’ç‰ˆï¼šå…©åˆ—è¨­è¨ˆ */
        .filter-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .select-group { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; font-weight: 600; color: #666; font-size: 0.9em; }
        
        select { 
            width: 100%; 
            padding: 12px; 
            border-radius: 10px; 
            border: 2px solid #e1e8ed; 
            font-size: 16px; 
            transition: all 0.3s;
            background-color: #fff;
            cursor: pointer;
        }
        select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,58,108,0.1); }
        select:disabled { background: #f9f9f9; cursor: not-allowed; border-color: #eee; }

        .result-card { 
            display: none; 
            margin-top: 30px; 
            padding: 25px; 
            border-radius: 15px; 
            background: #fff; 
            border: 1px solid #edf2f7;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }
        .item-box { margin-bottom: 20px; }
        .item-title { 
            display: flex; 
            align-items: center; 
            font-weight: bold; 
            color: var(--primary); 
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .item-title::before {
            content: "";
            display: inline-block;
            width: 4px;
            height: 18px;
            background: var(--accent);
            margin-right: 10px;
            border-radius: 2px;
        }
        .item-content { 
            white-space: pre-wrap; 
            background: #f8fafc; 
            padding: 15px; 
            border-radius: 8px; 
            line-height: 1.6;
            color: #4a5568;
            border: 1px solid #f1f5f9;
        }
        .loading { text-align: center; color: var(--primary); font-weight: 500; }

        @media (max-width: 600px) {
            .filter-grid { grid-template-columns: 1fr; }
            .container { padding: 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢</h1>
    
    <div id="loader" class="loading">ğŸ“¡ æ­£åœ¨é€£ç·šè‡³è³‡æ–™åº«...</div>
    
    <div class="filter-grid">
        <div class="select-group">
            <label>1. å­¸é™¢</label>
            <select id="sel-college" disabled><option>è®€å–ä¸­...</option></select>
        </div>
        <div class="select-group">
            <label>2. ç³»æ‰€</label>
            <select id="sel-dept" disabled><option>è«‹å…ˆé¸æ“‡å­¸é™¢</option></select>
        </div>
        <div class="select-group">
            <label>3. æ‹›ç”Ÿç®¡é“</label>
            <select id="sel-path" disabled><option>è«‹å…ˆé¸æ“‡ç³»æ‰€</option></select>
        </div>
        <div class="select-group">
            <label>4. å­¸å¹´åº¦</label>
            <select id="sel-year" disabled><option>è«‹å…ˆé¸æ“‡ç®¡é“</option></select>
        </div>
    </div>

    <div id="result" class="result-card">
        <div class="item-box">
            <div class="item-title">é¢è©¦æµç¨‹</div>
            <div id="res-process" class="item-content"></div>
        </div>
        <div class="item-box">
            <div class="item-title">é¢è©¦é¡Œç›®</div>
            <div id="res-questions" class="item-content"></div>
        </div>
        <div class="item-box">
            <div class="item-title">çµ¦å­¸å¼Ÿå¦¹çš„å»ºè­°</div>
            <div id="res-advice" class="item-content"></div>
        </div>
        <div class="item-box">
            <div class="item-title">å‚™å¯©æº–å‚™æ–¹å‘</div>
            <div id="res-portfolio" class="item-content"></div>
        </div>
    </div>
</div>

<script>
const publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTikTWQ1NHtmCIoslCCUnqJ_b-UOvFNnF2jkTFRYLthASVeGCZJOZDD5d9gZoy4X3zeQLhb-yHF2CRB/pub?output=csv';

let structure = {};

Papa.parse(publicSpreadsheetUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
        buildStructure(results.data);
        initDropdowns();
        document.getElementById('loader').style.display = 'none';
    }
});

function buildStructure(data) {
    structure = {};
    if (data.length === 0) return;

    // è‡ªå‹•åµæ¸¬æ¬„ä½åç¨± (è§£æ±ºå¯èƒ½å­˜åœ¨çš„ç©ºæ ¼æˆ–BOMå•é¡Œ)
    const keys = Object.keys(data[0]);
    const findKey = (target) => keys.find(k => k.trim().includes(target));
    
    const colKey = findKey('å­¸é™¢');
    const pathKey = findKey('æ‹›ç”Ÿç®¡é“');
    const yearKey = findKey('å­¸å¹´åº¦');

    data.forEach(row => {
        const col = row[colKey]?.trim();
        if (!col) return;

        // å‹•æ…‹æ‰¾ç³»æ‰€æ¬„ä½ (ç†å­¸é™¢ç³»æ‰€, å·¥å­¸é™¢ç³»æ‰€...)
        let deptKey = keys.find(k => k.includes(col) && k.includes('ç³»æ‰€'));
        let dept = deptKey ? row[deptKey]?.trim() : null;

        const path = row[pathKey]?.trim() || "ä¸€èˆ¬æ‹›ç”Ÿ";
        const yr = row[yearKey]?.trim() || "å¹´åº¦ä¸è©³";

        if (dept) {
            if (!structure[col]) structure[col] = {};
            if (!structure[col][dept]) structure[col][dept] = {};
            if (!structure[col][dept][path]) structure[col][dept][path] = {};
            structure[col][dept][path][yr] = row;
        }
    });
}

function initDropdowns() {
    const s1 = document.getElementById('sel-college');
    const s2 = document.getElementById('sel-dept');
    const s3 = document.getElementById('sel-path');
    const s4 = document.getElementById('sel-year');

    const colleges = Object.keys(structure).sort();
    if (colleges.length === 0) {
        s1.innerHTML = '<option>æ‰¾ä¸åˆ°è³‡æ–™ï¼Œè«‹ç¢ºèªè©¦ç®—è¡¨æ ¼å¼</option>';
        return;
    }

    s1.innerHTML = '<option value="">-- é¸æ“‡å­¸é™¢ --</option>';
    colleges.forEach(c => s1.add(new Option(c, c)));
    s1.disabled = false;

    s1.onchange = () => {
        resetNext(['sel-dept', 'sel-path', 'sel-year']);
        updateSelect(s2, structure[s1.value]);
    };

    s2.onchange = () => {
        resetNext(['sel-path', 'sel-year']);
        updateSelect(s3, structure[s1.value][s2.value]);
    };

    s3.onchange = () => {
        resetNext(['sel-year']);
        updateSelect(s4, structure[s1.value][s2.value][s3.value]);
    };

    s4.onchange = () => {
        const info = structure[s1.value][s2.value][s3.value][s4.value];
        const findVal = (target) => {
            const k = Object.keys(info).find(key => key.includes(target));
            return info[k] || 'ç„¡è³‡æ–™';
        };

        document.getElementById('res-process').innerText = findVal('é¢è©¦æµç¨‹');
        document.getElementById('res-questions').innerText = findVal('é¢è©¦é¡Œç›®');
        document.getElementById('res-advice').innerText = findVal('å»ºè­°');
        document.getElementById('res-portfolio').innerText = findVal('å‚™å¯©');
        document.getElementById('result').style.display = 'block';
    };
}

function updateSelect(el, dataSet) {
    el.innerHTML = '<option value="">-- è«‹é¸æ“‡ --</option>';
    if (dataSet) {
        Object.keys(dataSet).sort().forEach(k => el.add(new Option(k, k)));
        el.disabled = false;
    }
}

function resetNext(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        el.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡ä¸Šä¸€é …</option>';
        el.disabled = true;
    });
    document.getElementById('result').style.display = 'none';
}
</script>

</body>
</html>
