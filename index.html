<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --primary: #003a6c; --secondary: #f0f4f8; }
        body { font-family: "PingFang TC", sans-serif; background: #eef2f3; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); }
        .filter-section { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; }
        .result-card { display: none; margin-top: 25px; padding: 20px; border-radius: 10px; background: var(--secondary); border-left: 6px solid var(--primary); }
        .item-title { font-weight: bold; color: var(--primary); margin-top: 15px; font-size: 1.1em; }
        .item-content { white-space: pre-wrap; background: #fff; padding: 10px; border-radius: 5px; margin-top: 5px; border: 1px solid #eee; }
        .loading { text-align: center; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢</h1>
    <div id="loader" class="loading">æ­£åœ¨å¾è³‡æ–™åº«è¼‰å…¥æœ€æ–°è³‡æ–™...</div>
    
    <div class="filter-section">
        <select id="sel-college" disabled><option>è¼‰å…¥ä¸­...</option></select>
        <select id="sel-dept" disabled><option>è«‹é¸æ“‡å­¸é™¢</option></select>
        <select id="sel-path" disabled><option>è«‹é¸æ“‡ç³»æ‰€</option></select>
        <select id="sel-year" disabled><option>è«‹é¸æ“‡ç®¡é“</option></select>
    </div>

    <div id="result" class="result-card">
        <div class="item-title">â³ é¢è©¦æµç¨‹</div>
        <div id="res-process" class="item-content"></div>
        <div class="item-title">â“ é¢è©¦é¡Œç›®</div>
        <div id="res-questions" class="item-content"></div>
        <div class="item-title">ğŸ’¡ çµ¦å­¸å¼Ÿå¦¹çš„å»ºè­°</div>
        <div id="res-advice" class="item-content"></div>
        <div class="item-title">ğŸ“‚ å‚™å¯©æº–å‚™æ–¹å‘</div>
        <div id="res-portfolio" class="item-content"></div>
    </div>
</div>

<script>
// 1. é€™è£¡å¡«å…¥ä½ çš„ Google Sheets ç™¼å¸ƒç¶²å€
const publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTikTWQ1NHtmCIoslCCUnqJ_b-UOvFNnF2jkTFRYLthASVeGCZJOZDD5d9gZoy4X3zeQLhb-yHF2CRB/pub?output=csv';

let rawData = [];
const structure = {};

// åˆå§‹åŒ–ï¼šè®€å–è³‡æ–™
Papa.parse(publicSpreadsheetUrl, {
    download: true,
    header: true,
    complete: function(results) {
        rawData = results.data;
        buildStructure(rawData);
        initDropdowns();
        document.getElementById('loader').style.display = 'none';
    }
});

function buildStructure(data) {
    console.log("åŸå§‹è³‡æ–™ç¯„ä¾‹:", data[0]); // é™¤éŒ¯ç”¨ï¼šçœ‹ç¬¬ä¸€ç­†è³‡æ–™çš„æ¬„ä½åç¨±
    
    data.forEach(row => {
        const col = row['å­¸é™¢'] ? row['å­¸é™¢'].trim() : null;
        if (!col) return;

        // å‹•æ…‹åˆ¤æ–·ç³»æ‰€æ¬„ä½ï¼šå„ªå…ˆæ‰¾åŒ…å«è©²å­¸é™¢åç¨±ä¸”åŒ…å«ã€Œç³»æ‰€ã€å­—çœ¼çš„æ¬„ä½
        // é€™æ¨£å°±ä¸ç”¨ç®¡æœ‰æ²’æœ‰å•è™Ÿäº†
        let deptKey = Object.keys(row).find(key => key.includes(col) && key.includes('ç³»æ‰€'));
        let dept = deptKey ? row[deptKey] : null;

        const path = row['æ‹›ç”Ÿç®¡é“'] ? row['æ‹›ç”Ÿç®¡é“'].trim() : "æœªåˆ†é¡";
        const yr = row['å­¸å¹´åº¦'] ? row['å­¸å¹´åº¦'].trim() : "æœªçŸ¥";

        if (dept && dept.trim() !== "") {
            dept = dept.trim();
            if (!structure[col]) structure[col] = {};
            if (!structure[col][dept]) structure[col][dept] = {};
            if (!structure[col][dept][path]) structure[col][dept][path] = {};
            
            structure[col][dept][path][yr] = row;
        }
    });
    console.log("è§£æå¾Œçš„çµæ§‹:", structure); // å¦‚æœé€™è£¡æ˜¯ç©ºçš„ï¼Œä»£è¡¨æ²’æŠ“åˆ°ç³»æ‰€
}

function initDropdowns() {
    const s1 = document.getElementById('sel-college');
    const s2 = document.getElementById('sel-dept');
    const s3 = document.getElementById('sel-path');
    const s4 = document.getElementById('sel-year');

    s1.innerHTML = '<option value="">-- é¸æ“‡å­¸é™¢ --</option>';
    Object.keys(structure).sort().forEach(c => s1.add(new Option(c, c)));
    s1.disabled = false;

    s1.onchange = () => {
        resetDropdowns(['sel-dept', 'sel-path', 'sel-year']);
        updateNext(s1, 'sel-dept', structure[s1.value]);
    };
    
    s2.onchange = () => {
        resetDropdowns(['sel-path', 'sel-year']);
        updateNext(s2, 'sel-path', structure[s1.value][s2.value]);
    };

    s3.onchange = () => {
        resetDropdowns(['sel-year']);
        updateNext(s3, 'sel-year', structure[s1.value][s2.value][s3.value]);
    };

    s4.onchange = showResult;
}

function resetDropdowns(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        el.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡ä¸Šä¸€é …</option>';
        el.disabled = true;
    });
    document.getElementById('result').style.display = 'none';
}

function updateNext(current, nextId, nextData) {
    const next = document.getElementById(nextId);
    if (!current.value || !nextData) return;

    next.innerHTML = '<option value="">-- è«‹é¸æ“‡ --</option>';
    Object.keys(nextData).sort().forEach(k => next.add(new Option(k, k)));
    next.disabled = false;
}

function showResult() {
    const c = document.getElementById('sel-college').value;
    const d = document.getElementById('sel-dept').value;
    const p = document.getElementById('sel-path').value;
    const y = document.getElementById('sel-year').value;
    const info = structure[c][d][p][y];

    document.getElementById('res-process').innerText = info['é¢è©¦æµç¨‹'] || 'ç„¡è³‡æ–™';
    document.getElementById('res-questions').innerText = info['é¢è©¦é¡Œç›®'] || 'ç„¡è³‡æ–™';
    document.getElementById('res-advice').innerText = info['çµ¦å­¸å¼Ÿå¦¹çš„å»ºè­°'] || 'ç„¡è³‡æ–™';
    document.getElementById('res-portfolio').innerText = info['å‚™å¯©è³‡æ–™æº–å‚™æ–¹å‘'] || 'ç„¡è³‡æ–™';
    document.getElementById('result').style.display = 'block';
}
</script>
</body>
</html>
