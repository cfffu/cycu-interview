<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --primary: #003a6c; --accent: #00a896; --bg: #f0f4f8; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 850px; margin: 30px auto; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 35px; font-size: 1.7rem; }
        .filter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .select-group { display: flex; flex-direction: column; }
        label { margin-bottom: 6px; font-weight: bold; color: #555; font-size: 0.9em; }
        select { padding: 12px; border-radius: 10px; border: 2px solid #ddd; font-size: 15px; background: white; cursor: pointer; transition: 0.3s; }
        select:focus { border-color: var(--primary); outline: none; }
        select:disabled { background: #f5f5f5; cursor: not-allowed; opacity: 0.7; }
        .result-card { display: none; margin-top: 30px; padding: 25px; border-radius: 15px; background: #fff; border-top: 5px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .item-box { margin-bottom: 20px; }
        .item-title { font-weight: bold; color: var(--primary); margin-bottom: 8px; font-size: 1.05em; display: flex; align-items: center; }
        .item-title::before { content: "â—†"; margin-right: 8px; color: var(--accent); }
        .item-content { white-space: pre-wrap; background: #f9f9f9; padding: 15px; border-radius: 8px; line-height: 1.6; border: 1px solid #eee; }
        .loading { text-align: center; color: #666; font-style: italic; }
        @media (max-width: 600px) { .filter-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ ä¸­åŸå¤§å­¸é¢è©¦ç¶“é©—æŸ¥è©¢</h1>
    <div id="loader" class="loading">æ­£åœ¨é€£ç·šè‡³é›²ç«¯è³‡æ–™åº«...</div>
    
    <div class="filter-grid">
        <div class="select-group"><label>1. é¸æ“‡å­¸é™¢</label><select id="sel-college" disabled><option>è¼‰å…¥ä¸­...</option></select></div>
        <div class="select-group"><label>2. é¸æ“‡ç³»æ‰€</label><select id="sel-dept" disabled><option>è«‹å…ˆé¸æ“‡å­¸é™¢</option></select></div>
        <div class="select-group"><label>3. æ‹›ç”Ÿç®¡é“</label><select id="sel-path" disabled><option>è«‹å…ˆé¸æ“‡ç³»æ‰€</option></select></div>
        <div class="select-group"><label>4. å­¸å¹´åº¦</label><select id="sel-year" disabled><option>è«‹å…ˆé¸æ“‡ç®¡é“</option></select></div>
    </div>

    <div id="result" class="result-card">
        <div class="item-box"><div class="item-title">é¢è©¦æµç¨‹</div><div id="res-process" class="item-content"></div></div>
        <div class="item-box"><div class="item-title">é¢è©¦é¡Œç›®</div><div id="res-questions" class="item-content"></div></div>
        <div class="item-box"><div class="item-title">çµ¦å­¸å¼Ÿå¦¹çš„å»ºè­°</div><div id="res-advice" class="item-content"></div></div>
        <div class="item-box"><div class="item-title">å‚™å¯©æº–å‚™æ–¹å‘</div><div id="res-portfolio" class="item-content"></div></div>
    </div>
</div>

<script>
// ä½ çš„ CSV ç¶²å€
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTikTWQ1NHtmCIoslCCUnqJ_b-UOvFNnF2jkTFRYLthASVeGCZJOZDD5d9gZoy4X3zeQLhb-yHF2CRB/pub?output=csv';

let structure = {};

Papa.parse(csvUrl, {
    download: true, header: true, skipEmptyLines: true,
    complete: function(results) {
        // [é™¤éŒ¯ç”¨] å¦‚æœé‚„æ˜¯ç©ºçš„ï¼Œè«‹åœ¨ç¶²é æŒ‰ F12 çœ‹ Console
        console.log("CSV æ¨™é¡Œåˆ—:", Object.keys(results.data[0])); 
        buildStructure(results.data);
        initDropdowns();
        document.getElementById('loader').style.display = 'none';
    }
});

function buildStructure(data) {
    structure = {};
    data.forEach(row => {
        // 1. åœ°æ¯¯å¼æœå°‹å­¸é™¢æ¬„ä½
        const colKey = Object.keys(row).find(k => k.includes("å­¸é™¢") && !k.includes("å“ªäº›"));
        const colFull = row[colKey]?.trim();
        if (!colFull) return;

        // 2. è™•ç†ç³»æ‰€æ¬„ä½ï¼šå¾å­¸é™¢åç¨±æå–é—œéµå­— (ä¾‹å¦‚ "ç†å­¸é™¢" æ‰¾åŒ…å« "ç†å­¸é™¢" çš„æ¬„ä½)
        const pureColName = colFull.split('ï¼ˆ')[0].trim();
        const deptKey = Object.keys(row).find(k => k.includes(pureColName) && k !== colKey);
        let dept = row[deptKey]?.trim();

        // 3. æœå°‹ç®¡é“èˆ‡å¹´ä»½
        const pathKey = Object.keys(row).find(k => k.includes("ç®¡é“"));
        const yearKey = Object.keys(row).find(k => k.includes("å­¸å¹´åº¦"));
        const path = row[pathKey]?.trim() || "ä¸€èˆ¬æ‹›ç”Ÿ";
        const yr = row[yearKey]?.trim() || "114";

        if (dept) {
            if (!structure[colFull]) structure[colFull] = {};
            if (!structure[colFull][dept]) structure[colFull][dept] = {};
            if (!structure[colFull][dept][path]) structure[colFull][dept][path] = {};
            structure[colFull][dept][path][yr] = row;
        }
    });
}

function initDropdowns() {
    const s1 = document.getElementById('sel-college');
    const s2 = document.getElementById('sel-dept');
    const s3 = document.getElementById('sel-path');
    const s4 = document.getElementById('sel-year');

    const colleges = Object.keys(structure).sort();
    if (colleges.length === 0) {
        s1.innerHTML = '<option>è§£æå¤±æ•—ï¼Œè«‹ç¢ºèªè³‡æ–™æ¬Šé™</option>';
        return;
    }

    s1.innerHTML = '<option value="">-- é¸æ“‡å­¸é™¢ --</option>';
    colleges.forEach(c => s1.add(new Option(c, c)));
    s1.disabled = false;

    s1.onchange = () => { resetSelect(['sel-dept', 'sel-path', 'sel-year']); updateSelect(s2, structure[s1.value]); };
    s2.onchange = () => { resetSelect(['sel-path', 'sel-year']); updateSelect(s3, structure[s1.value][s2.value]); };
    s3.onchange = () => { resetSelect(['sel-year']); updateSelect(s4, structure[s1.value][s2.value][s3.value]); };
    s4.onchange = showResult;
}

function updateSelect(el, dataSet) {
    el.innerHTML = '<option value="">-- è«‹é¸æ“‡ --</option>';
    if (dataSet) { Object.keys(dataSet).sort().forEach(k => el.add(new Option(k, k))); el.disabled = false; }
}

function resetSelect(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        el.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡ä¸Šä¸€é …</option>';
        el.disabled = true;
    });
    document.getElementById('result').style.display = 'none';
}

function showResult() {
    const info = structure[document.getElementById('sel-college').value]
                          [document.getElementById('sel-dept').value]
                          [document.getElementById('sel-path').value]
                          [document.getElementById('sel-year').value];

    // åœ°æ¯¯å¼æœå°‹çµæœæ¬„ä½
    const findContent = (keywords) => {
        const key = Object.keys(info).find(k => keywords.some(kw => k.includes(kw)));
        return info[key] || 'ï¼ˆç„¡è³‡æ–™ï¼‰';
    };

    document.getElementById('res-process').innerText = findContent(['æµç¨‹']);
    document.getElementById('res-questions').innerText = findContent(['é¡Œç›®']);
    document.getElementById('res-advice').innerText = findContent(['å»ºè­°', 'å­¸å¼Ÿå¦¹']);
    document.getElementById('res-portfolio').innerText = findContent(['å‚™å¯©', 'æ–¹å‘']);
    document.getElementById('result').style.display = 'block';
}
</script>
</body>
</html>
